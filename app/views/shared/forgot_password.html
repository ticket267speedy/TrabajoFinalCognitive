<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recuperar Contraseña</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #f6f8fa; margin: 0; }
      .container { max-width: 480px; margin: 8vh auto; background: #fff; padding: 24px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
      h1 { font-size: 20px; margin: 0 0 16px; }
      p { font-size: 14px; color: #57606a; }
      label { display: block; font-size: 14px; margin: 12px 0 6px; }
      input { width: 100%; padding: 10px 12px; border: 1px solid #d0d7de; border-radius: 8px; font-size: 14px; }
      button { width: 100%; margin-top: 18px; padding: 10px 14px; border: 0; border-radius: 8px; background: #0969da; color: #fff; font-weight: 600; cursor: pointer; }
      button:disabled { opacity: 0.6; cursor: default; }
      .msg { margin-top: 12px; font-size: 14px; }
      .msg.error { color: #d1242f; }
      .msg.success { color: #1a7f37; }
      .actions { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
      a { color: #0969da; text-decoration: none; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Recuperar Contraseña</h1>
      <p>Ingresa tu email y te enviaremos instrucciones para restablecer tu contraseña.</p>
      <form id="forgotForm">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" required placeholder="tu@correo.com" />

        <button id="submitBtn" type="submit">Enviar instrucciones</button>
        <div id="message" class="msg" aria-live="polite"></div>
      </form>
      <div class="actions">
        <a href="/login">Volver al login</a>
        <a href="/register">Crear cuenta</a>
      </div>
    </div>

    <script>
      const form = document.getElementById('forgotForm');
      const messageEl = document.getElementById('message');
      const submitBtn = document.getElementById('submitBtn');

      function setMessage(text, kind = 'error') {
        messageEl.textContent = text || '';
        messageEl.className = `msg ${kind}`;
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        setMessage('');

        const email = document.getElementById('email').value.trim().toLowerCase();
        if (!email) {
          setMessage('Por favor ingresa tu email.');
          return;
        }

        submitBtn.disabled = true;
        try {
          // Endpoint reservado para el flujo de recuperación de asesores
          const res = await fetch('/api/asesores/password/forgot', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });

          const data = await res.json().catch(() => ({}));

          if (res.ok) {
            setMessage('Si el email existe, te enviaremos un correo con instrucciones.', 'success');
          } else {
            // Mensaje genérico para no filtrar existencia del email
            setMessage('Si el email existe, te enviaremos un correo con instrucciones.', 'success');
          }
        } catch (err) {
          setMessage('Error de red. Intenta nuevamente.');
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
  </html>